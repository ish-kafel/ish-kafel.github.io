<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, user-scalable=yes, initial-scale=0.7, maximum-scale=0.7, minimum-scale=0.6" />
  <script type="text/javascript" src="js/qrcode.js"></script>
  <style>
    @font-face {
      font-family: 'Cuniform';
      src: url(font/NotoSansCuneiform-Regular.woff2) format("woff2");
      unicode-range: U+12000-123FF;
    }

    input[type="checkbox"] {
      zoom: 1.5;
      vertical-align: bottom;
    }

    button {
      width: 90;
      font-size: 16;
    }

    textarea {
      font-family: 'monospace';
      width: 500;
      height: 115;
      font-size: 16;
    }

    select {
      height: 27;
      width: 50;
      font-size: 16;
    }
  </style>
</head>

<body>
  <button onclick="javascript:window.location.href='../'">回首页</button><br>
  <textarea id="text" oninput="make()"></textarea>
  <div>
    <select id='se' onchange="changeErrorLevel()">
      <option value='L'>低</option>
      <option value='M'>中</option>
      <option value='Q'>优</option>
      <option selected="selected" value="H">高</option>
    </select>
    <input id="usesvg" type="checkbox" onclick="useSvg()" checked="checked" />使用SVG<input id="minisvg" type="checkbox" onclick="mini()" checked="checked" />压缩SVG<input id="animesvg" type="checkbox" onclick="anime()" />SVG描边动画（同步）<br /><input id="anime1svg" type="checkbox" onclick="anime1()" />SVG描边动画（顺序）
    <button style="display:none" onclick="randomStr()">随机生成</button>
  </div>
  <div id="qrcode" style="margin-top:15px;"></div>

  <script type="text/javascript">
    let $ = s => document.querySelector(s)
    let qr = {
      width: 500,
      height: 500,
      colorDark: "#000",
      colorLight: "#fff",
      correctLevel: QRCode.CorrectLevel.H,
      useSVG: true,
      pathCombine: true,
      animeSVG: false
    }

    function randomWord(min, max) {
      var str = "",
        range = min,
        arr = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ',
        pos;
      if (max) {
        range = Math.round(Math.random() * (max - min)) + min;
      }
      for (var i = 0; i < range; i++) {
        pos = Math.round(Math.random() * (arr.length - 1));
        str += arr[pos];
      }
      return str;
    }

    function randomStr() {
      $("#text").value = randomWord(1270)
      make()
      let num = 26510
      let i = 0
      while (maxLen <= num && i < 100) {
        $("#text").value = randomWord(1270)
        make()
        i++
      }
    }
    $("#usesvg").checked = qr.useSVG
    $("#minisvg").checked = qr.pathCombine
    var qrcode = new QRCode($("#qrcode"), qr);

    function changeErrorLevel() {
      var tn = $("#qrcode")
      tn.innerHTML = ''
      var x = $("#se").value;
      qr.correctLevel = QRCode.CorrectLevel[x]
      qrcode = new QRCode($("#qrcode"), qr);
      qrcode.makeCode($("#text").value)
    }

    function useSvg() {
      let chkbx = $("#usesvg")
      let tn = $("#qrcode")
      let bool = chkbx.checked
      qr.useSVG = bool
      $("#minisvg").disabled = !bool
      $("#animesvg").disabled = !bool||!minisvg.checked
      $("#anime1svg").disabled = !bool||!minisvg.checked
      tn.innerHTML = ''
      qrcode = new QRCode($("#qrcode"), qr);
      qrcode.makeCode($("#text").value)
    }

    function mini() {
      let chkbx = $("#minisvg")
      let tn = $("#qrcode")
      qr.pathCombine = chkbx.checked
      $("#animesvg").disabled = !chkbx.checked
      $("#anime1svg").disabled = !chkbx.checked
      tn.innerHTML = ''
      qrcode = new QRCode($("#qrcode"), qr);
      qrcode.makeCode($("#text").value)
    }

    function anime() {
      let chkbx = $("#animesvg")
      let tn = $("#qrcode")
      anime1svg.checked = false
      qr.anime1SVG = false
      qr.animeSVG = chkbx.checked
      tn.innerHTML = ''
      qrcode = new QRCode($("#qrcode"), qr);
      qrcode.makeCode($("#text").value)
    }

    function anime1() {
      let chkbx = $("#anime1svg")
      let tn = $("#qrcode")
      animesvg.checked = false
      qr.animeSVG = false
      qr.anime1SVG = chkbx.checked
      tn.innerHTML = ''
      qrcode = new QRCode($("#qrcode"), qr);
      qrcode.makeCode($("#text").value)
    }

    function make() {
      //qrcode.clear()
      let tn = $("#qrcode")
      tn.innerHTML = ''
      qrcode = new QRCode($("#qrcode"), qr);
      qrcode.makeCode($("#text").value)
    }

    make();
  </script>
</body>